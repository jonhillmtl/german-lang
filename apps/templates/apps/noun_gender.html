{% extends 'apps/base.html' %}

{% block content %}
    <div class="noun_gender_flash">
        <span id="singular_span"></span>
    </div>

    <div class="noun_gender_flash">
        <span id="plural_span"></span>
    </div>

    <div id="id_buttons" class="noun_gender_buttons">
        <button class="n neutral">das</button>
        <button class="f feminine">die</button>
        <button class="m masculine" >der</button>
    </div>

    <div id="id_correction_overlay" class="noun_gender_correction_overlay">
        <div class="noun_gender_correction"><span id="id_correction_correct"></span></div>
        <input type="text" id="id_correction_text"></input>
        <button id="id_correction_submit">Submit</button>
    </div>

    <div id="id_score_container" class="noun_gender_score">
        <div id="id_score"></div>
    </div>

    <script type="text/javascript">
        var token = 'eyJhbGciOiJBMjU2S1ciLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIn0.3QinpQBFzEtSSa3wPvgPOQcqKFObVX3jTciJsV5KxYlnrl5mVhuQkeKLLkdKeyT3Cc49rZntALAGNeJ-VjBApJ-hzGccEZ-_.qO2mq8PCSDXNViNjRXYG5g.5SNRT5dGvb2wCNsYL43RW4unVBThDnovDGbf3AS3zVxEqDm1IjGoIe6DdYL0qwKEKgiLsTJ2NpQS4A96GndJZgh6gftwZot38Lwq3R9Nk83bHXzx-vMG2saij2nEGW42-GBwcWXDwinAW91EzzJkGJghXkn4cuU72jEJnwXdqRK-P0z_PAGl27mVkIOyU1giy53o5JTnKD-GSpQiQWAFGPOX8GLCQCsbXFBnyHO0flnkpmXRuFRZ18kqyJfE_sZ5KR47Jc1PRkqd3jizmR2NcnK84qj3bb2Zfml4q8UylbpL06G5CTS8N1QR6e3XzKK-3mHd6qLDs81UC4RMYU9QF3eUkvEuw_bul01mrOJTsauRYW1Gfa8xSXYRhFG097XltjjVnrLhg1hBXw8WTKWPCFNrPcYvIWX4-yW8UQxyUw5Mva6xYSXkLLlHbR43GUoqKcuLofEnxB5rW_rKispORjOxUEhcNNQvjGdUMKtugBMoqNKB8yZMrhIRgM_THFFSiFSnOJxpkSEruEAGjuIcPw.BLniI2Hw715EUagl7qi9MTiGx-ulRMPNhmdZkGaGNMo';

        var current_id = 0;
        var current_noun = null;
        var correct = 0;
        var total = 0;
        
        function refresh_stats()
        {
            url = 'http://0.0.0.0:8080/api/nouns/gender/stats/';
            $.ajax({
                url: url,
                method: 'GET',
                dataType: 'json',
                success: function(data)
                {
                    $("#id_score").text(data.all_time);
                }
            });
        }
        
        function get_noun()
        {
            url = 'http://0.0.0.0:8080/api/nouns/';
            $.ajax({
                url: url,
                method: 'GET',
                dataType: 'json',
                success: function(data)
                {
                    console.log(data);
                    $("#singular_span").html(data.noun.singular_form);
                    $("#plural_span").html(data.noun.plural_form);
                    current_id = data.noun.id;
                    current_noun = data.noun;
                }
            });
        }
        
        function submit(gender)
        {
            var url = 'http://0.0.0.0:8080/api/nouns/' + current_id + '/gender/';
            $.post({
                url: url,
                success: function(data)
                {
                    total += 1;
                    if(data.results)
                    {
                        correct += 1;        
                        get_noun();
                    }
                    else
                    {
                        $("#id_correction_correct").html(data.correction);
                        $("#id_correction_overlay").show();
                        $("#id_correction_text").val('')
                    }

                    var percentage = Math.round(correct / total * 100);
                },
                data: JSON.stringify(
                    {
                        'gender' : gender
                    }
                )
            });
        }

        $(document).ready(function()
        {
            $.ajaxSetup({
                headers:
                { 
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content'),
                    'Authorization': token,
                    'Content-Type':'application/json'
                }
            });
            
            refresh_stats();

            get_noun();

            $(".n").click(function(){
                submit('n');
            });

            $(".f").click(function(){
                submit('f');
            });

            $(".m").click(function(){
                submit('m');
            });
            
            $("#id_correction_submit").click(function()
            {
                var url = 'http://0.0.0.0:8080/api/nouns/' + current_id + '/gender/correction/';
                $.post({
                    url: url,
                    success: function(data)
                    {
                        if(data.success)
                        {
                            get_noun();
                            $("#id_correction_overlay").hide();
                        }
                    },
                    data: JSON.stringify(
                        {
                            'correction' : $("#id_correction_text").val()
                        }
                    )
                });
            });
        });
        
    </script>
{% endblock %}